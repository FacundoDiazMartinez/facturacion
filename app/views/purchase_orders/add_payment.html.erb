<%= nested_form_for @purchase_order do |form| %>

<div class="p-4">
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-3">
    <h1 class="h2">
      Órden de Compra para:
      <%= @purchase_order.supplier.name %>
    </h1>
  </div>
  <hr>

  <div class="page-section">
    <div class="col-6 offset-3">
      <div class="card shadow">
        <div class="fields">

          <div class="margins_top_right_left_1rem">
            <label for="">Registrar pagos para Órden de Compra N°:
              <%= @purchase_order.number %></label>
          </div>
          <hr>
          <div class="form-group m-4">
            <b>Total:</b>
            $<%= @purchase_order.total %>
            -
            <b>Monto faltante:</b>
            $<label id="faltante" style="font-weight: 400;"><%= @purchase_order.total.to_f - Payment.where(purchase_order_id: @purchase_order.id).sum(:total).to_f %></label>
            <%= form.link_to_add "#{icon('fas', 'plus')} <span class='only-desktop'>Agregar pago</span>".html_safe, :expense_payments, class: 'btn btn-sm btn-success float-right mr-4', data: {target: '#payments'}%>
          </div>

          <div class="payments">
            <div class="table-responsive-sm m-4">
              <table class="table table-striped invoice-table" id="payments" style="width: 100%;">
                <thead>
                  <tr>
                    <th scope="col">Tipo de pago</th>
                    <th scope="col">Monto</th>
                    <th scope="col">Fecha de pago</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <%= form.fields_for :expense_payments, form.object.expense_payments.build, wrapper: false do |f| %>
                  <tr class="fields">
                    <td><%= f.select :type_of_payment, Payment::TYPES.map{|k,v| [v,k]}, {}, {class: 'form-control form-control-sm', style: 'min-width: 100px;'} %></td>
                    <td><%= f.number_field :total, class: 'form-control form-control-sm purchase_order_payment_amount', default: 0.0 %></td>
                    <td><%= f.text_field :payment_date, class: 'form-control form-control-sm datepicker' %></td>
                    <td><%= f.link_to_remove icon('fas', 'trash') %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <%= save_button %>
    </div>
  </div>
</div>

</div>
<% end -%>
