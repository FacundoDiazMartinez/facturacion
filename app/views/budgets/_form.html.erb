<%= error_explanation @budget %>

<%= nested_form_for(@budget) do |f| %>
  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="form-group col-4">
          <%= label_tag :number, "Número" %>
          <%= text_field_tag :number, f.object.number || "GENERADO AUTOMATICAMENTE", class: 'form-control', disabled: true %>
        </div>
        <div id="client_form" class="col-4">
          <%= render 'client_column' %>
        </div>
        <%= f.hidden_field :client_id, value: @client.id %>
        <div class="form-group col-4">
          <%= f.label :expiration_date, "Vencimiento" %>
          <%= f.text_field :expiration_date, class: "form-control datepicker", autocomplete: "off", disabled: !@budget.editable?, value: f.object.expiration_date %>
        </div>
        <div class="form-group col-4">
          <%= f.label :reserv_stock, "¿Reservar stock?" %>
          <div>
            <%= f.check_box :reserv_stock, class: "toggle", data:{ toggle: 'toggle', on: "Si", off: "No" }, disabled: !@budget.editable? %>
          </div>
        </div>
        <% if @budget.facturado? %>
          <div class="form-group col-2">
            <%= f.label :state, "Estado" %>
            <div class="h4">
              <%= state_label_helper_budget @budget %>
            </div>
          </div>
          <div class="form-group col-2">
            <%= label_tag :state, "Factura" %>
            <%= link_to "#{icon('fas', 'arrow-right')} Ir".html_safe, edit_invoice_path(@budget.invoice), class: 'btn btn-primary w-100' %>
          </div>
        <% else %>
          <div class="form-group col-4">
            <%= f.label :state, "Estado" %>
            <%= f.select :state, options_for_select([["Válido", "Válido"], ["Confirmado", "Confirmado"], ["Anulado", "Anulado"]], f.object.state), {}, { class: 'form-control', disabled: !@budget.editable? } %>
          </div>
        <% end %>
        <div class="form-group col-4">
          <%= f.label :total, "Total ($)" %>
          <%= f.number_field :total, class: "form-control", disabled: true %>
        </div>
        <div class="form-group col-12">
          <%= f.label :observation, "Observaciones" %>
          <%= f.text_area :observation, class: "form-control", disabled: !@budget.editable? %>
        </div>
      </div>

      <% if @budget.persisted? && @budget.confirmado? %>
        <div class="d-flex justify-content-center m-2">
          <%= link_to "#{icon('fas', 'check-square')} Confirmar venta".html_safe, new_invoice_path(budget_id: @budget.id), class: 'btn btn-success mx-2' %>
          <%= link_to "#{icon('fas', 'file-pdf')} Imprimir".html_safe, budget_path(@budget.id, format: :pdf), class: 'btn btn-primary mx-2' %>
        </div>
      <% end -%>
    </div>
  </div>


  <p class="h4 text-muted">Conceptos</p>
  <div class="card" id="idetails">
    <%= render template: '/budgets/detail/index.html.erb', locals:{form: f} %>
  </div>

  <div class="text-center">
    <%= save_button if @budget.editable? %>
  </div>
<% end %>

<%= render '/budgets/detail/search_product' %>
<div class="modal fade bd-example-modal-lg" id="clientModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div id="client_modal">
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function(){
  $('[data-toggle="tooltip"]').tooltip();
});
</script>
